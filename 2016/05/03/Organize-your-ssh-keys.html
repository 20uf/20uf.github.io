<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Michael COULLERET aka 20uf">

        <title>Se simplifier la vie avec vos clefs ssh</title>

        <link href="/css/bootstrap.mco.min.css" rel="stylesheet">
        <link href="/css/theme.css" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link href="https://file.myfontastic.com/n6vo44Re5QaWo8oCKShBs7/icons.css" rel="stylesheet">
        <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    </head>

    <body>
    
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle" data-toggle="collapse"
                            data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#page-top">Michael COULLERET aka 20uf</a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="https://www.coulleret.pro">Qui suis-je ?</a>
                        </li>
                                                                                                                        <li>
                                        <a href="../../../index.html">
                                            Blog
                                        </a>
                                    </li>
                                                                                                        </ul>
                </div>
            </div>
        </nav>

                <section class="content">
                <div class="container">
                                                <h1></h1>
                            
              <article>
    <p class="text-muted">
      <span class="glyphicon glyphicon-calendar"></span>
      May 3rd, 2016
    </p>

    <div class="body">
      <h2 id="organisez-vos-clefs-ssh">Organisez vos clefs ssh<a href="#organisez-vos-clefs-ssh" class="anchor">#</a></h2>
<h4 id="generer-une-cle-privee-et-une-cle-publique">Générer une clé privée et une clé publique<a href="#generer-une-cle-privee-et-une-cle-publique" class="anchor">#</a></h4>
<p>Une clé SSH vous permet d'établir une connexion sécurisée entre votre ordinateur et un serveur.</p>
<p>Pour générer une nouvelle clé SSH, utilisez la commande suivante:</p>
<pre><code>ssh-keygen -t rsa -C "votre@email.com"</code></pre>
<p>Cette commande vous demandera un emplacement et un nom pour stocker la paire de clés et un mot de passe.
Je conseille d'utiliser l'emplacement par defaut correspondant et de nommer votre clé selon son utilité, par exemple pour github </p>
<pre><code>~/.ssh/id_github</code></pre>
<p>Une seconde question vous demande un passphrase, il est fortement recommandé d'en utiliser un</p>
<pre><code>Enter passphrase (empty for no passphrase): **************</code></pre>
<p>Vous devriez avoir un retour de ce type:</p>
<pre><code>Your identification has been saved in /home/demo/.ssh/id_rsa.
Your public key has been saved in /home/demo/.ssh/id_rsa.pub.
The key fingerprint is:
4a:dd:0a:c6:35:4e:3f:ed:27:38:8c:74:44:4d:93:67 demo@a
The key's randomart image is:
+--[ RSA 2048]----+
|          .oo.   |
|         .  o.E  |
|        + .  o   |
|     . = = .     |
|      = S = .    |
|     o + = +     |
|      . o + o .  |
|           . o   |
|                 |
+-----------------+</code></pre>
<p>Votre clé est maintenant générée et prête à defaut utilisée.</p>
<p>Si vous souhaitez copier votre clé sur un serveur distant, vous pouvez procéder ainsi:</p>
<pre><code>cat ~/.ssh/id_rsa.pub | ssh user@host "mkdir -p ~/.ssh && cat >>  ~/.ssh/authorized_keys"</code></pre>
<p>Une fois que vous avez copié vos clés SSH vers votre serveur, vérifier que vous pouvez vous connecter avec les clés SSH:</p>
<pre><code>ssh user@host</code></pre>
<h4 id="configurer-ses-cles">Configurer ses clés<a href="#configurer-ses-cles" class="anchor">#</a></h4>
<p>Une astuce pour se simplifier la vie avec vos clefs ssh, creez un fichier dans la dossier .ssh :</p>
<pre><code>vim ~/.ssh/config</code></pre>
<p>Créez une configuration differentes pour chaque serveurs ssh:</p>
<pre><code>Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_rsa

Host gitlab.domain.fr
    HostName gitlab.domain.fr
    User git
    IdentityFile ~/.ssh/id_other_rsa</code></pre>
<p>Et le tour est joué !</p>
<h4 id="quelques-options">Quelques options:<a href="#quelques-options" class="anchor">#</a></h4>
<table><thead><tr><th style="text-align: left;">Commande</th>
<th style="text-align: center;">Paramètre</th>
<th style="text-align: right;">Description</th>
</tr></thead><tbody><tr><td style="text-align: left;"><code>hote</code></td>
<td style="text-align: center;">hostname/ip</td>
<td style="text-align: right;">adresse de la machine</td>
</tr><tr><td style="text-align: left;"><code>RSAAuthentication</code></td>
<td style="text-align: center;">yes/no</td>
<td style="text-align: right;">authentification RSA, clé publique/privé généré avec "ssh-keygen"</td>
</tr><tr><td style="text-align: left;"><code>PubKeyAuthentication</code></td>
<td style="text-align: center;">yes/no</td>
<td style="text-align: right;">s'authentifier avec une clé public</td>
</tr><tr><td style="text-align: left;"><code>PasswordAuthentication</code></td>
<td style="text-align: center;">yes/no</td>
<td style="text-align: right;">authentification avec mot de passe (a pas confondre avec passphrase)</td>
</tr><tr><td style="text-align: left;"><code>CheckHostIP</code></td>
<td style="text-align: center;">yes/no</td>
<td style="text-align: right;">Verifie l'IP host n'est pas une usurpation DNS</td>
</tr><tr><td style="text-align: left;"><code>IdentityFile</code></td>
<td style="text-align: center;">~/.ssh/id_dsa</td>
<td style="text-align: right;">défini la clé privé a utiliser pour s'authentifier</td>
</tr><tr><td style="text-align: left;"><code>User</code></td>
<td style="text-align: center;">user</td>
<td style="text-align: right;">compte à utiliser pour l'identification</td>
</tr><tr><td style="text-align: left;"><code>Port</code></td>
<td style="text-align: center;">port</td>
<td style="text-align: right;">numéro de port à utiliser</td>
</tr><tr><td style="text-align: left;"><code>HashKnownHosts</code></td>
<td style="text-align: center;">yes/no</td>
<td style="text-align: right;">Permet d'avoir un fichier known_hosts plus lisible</td>
</tr></tbody></table><h4 id="securite-sur-votre-serveur-ssh">Sécurité sur votre serveur SSH<a href="#securite-sur-votre-serveur-ssh" class="anchor">#</a></h4>
<p>Le login root ne doit pas être autorisée par l'intermédiaire des clés SSH.</p>
<p>Pour ce faire, ouvrez le fichier SSH config sur votre serveur distant:</p>
<pre><code>vim /etc/ssh/sshd_config</code></pre>
<p>Dans ce fichier, trouvez la ligne qui comprend PermitRootLogin et modifiez le pour garantir que seuls les utilisateurs peuvent se connecter avec leur clé SSH:
PermitRootLogin sans mot de passe</p>
<pre><code>PermitRootLogin without-password</code></pre>
<p>Mettez les changements en vigueur:</p>
<pre><code>reload ssh</code></pre>
    </div>

          <hr>
      <h4><span class="glyphicon glyphicon-tags"></span>&nbsp;
                    <a href="../../../tags/ssh.html"><span class="label label-primary">Ssh</span></a>
                    <a href="../../../tags/debian.html"><span class="label label-primary">Debian</span></a>
              </h4>
      </article>
        </section>
        

                        <footer>
            <p class="text-center">
                &copy;
                                    <a href="https://www.coulleret.pro">
                        Michael COULLERET aka 20uf
                    </a>
                                2016
                <small>
                    - Propulsé par <a href="http://carew.github.com/" target="_blank">Carew</a>
                </small>
            </p>
        </footer>
        


        </body>
</html>